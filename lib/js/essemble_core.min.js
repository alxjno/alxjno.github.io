/* @preserve AUTHOR: Ian Duff EMAIL: ian.duff@essemble.co.uk COPYRIGHT: Essemble Ltd All code Â© 2019 Essemble Ltd. All rights reserved.
 This code is the property of Essemble Ltd and cannot be copied, reused or modified without prior permission from the author
*/
function extend(t,e){var i=e.prototype;e.prototype=Object.create(t.prototype);for(var n in i)e.prototype[n]=i[n];e.prototype.constructor=e,Object.defineProperty(e.prototype,"constructor",{enumerable:!1,value:e})}function get(t){return document.getElementById(t)}function getJQ(t){return $("#"+t)}function loadXML(t,e){$.ajax({type:"GET",url:t,dataType:"xml",error:xmlError,success:e})}function xmlError(t,e){alert("xmlError "+e)}function checkValue(t){var e=t;return parseFloat(t)>1&&(e=parseFloat(t)/100),e}function checkColour(t){var e=null;return"string"==typeof t&&""!=t&&(-1!=t.indexOf("rgb")||-1!=t.indexOf("transparent")||-1!=t.indexOf("gradient")?e=t:"#"!=(e=t.replace("0x","")).charAt(0)&&(e="#"+e)),e}function getUnit(t){return"string"==typeof t&&-1==t.indexOf("%")&&-1==t.indexOf("px")&&-1==t.indexOf("em")&&-1==t.indexOf("calc")&&(t+="px"),t}function xmlAttr(t,e){return!!t.attr(e)}function xmlAttrNum(t,e){var i=null;if(xmlAttr(t,e)){var n=t.attr(e);isNaN(parseInt(n))||(i=Number(n))}return i}function xmlAttrStr(t,e){var i=null;if(xmlAttr(t,e)){var n=t.attr(e);""!=n&&(i=n)}return i}function xmlAttrBoo(t,e,i){var n=i;if(xmlAttr(t,e)){var s=t.attr(e);""!=s&&(n=Boolean("true"==s.toLowerCase())||Boolean("1"==s.toLowerCase()))}return n}function create(t){var e=document.createElement(t.type);return t.id&&(e.id=t.id),t.className&&(e.className=t.className),t.imgSrc&&(e.src=t.imgSrc),t.href&&(e.href=t.href),t.inputType&&(e.type=t.inputType),t.inputValue&&(e.value=t.inputValue),t.value&&(e.value=t.value),t.title&&(e.title=t.title,e.alt=t.title),t.onMouseOver&&(e.onmouseover=t.onMouseOver),t.onMouseOut&&(e.onmouseout=t.onMouseOut),t.onMouseDown&&(e.onmousedown=t.onMouseDown),t.onFocus&&(e.onfocus=t.onFocus),t.onBlur&&(e.onblur=t.onBlur),t.onClick&&(e.onclick=t.onClick),t.tabIndex&&(e.tabIndex=t.tabIndex),t.accessKey&&(e.accessKey=t.accessKey),t.zindex&&(e.zIndex=t.zindex),t.innerHTML&&(e.innerHTML=t.innerHTML),e}function replaceXMLStr(t,e,i){var n=(new XMLSerializer).serializeToString(t);e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var s=new RegExp(e,"g"),r=n.replace(s,i);return $.parseXML(r).firstChild}function hexToR(t){return parseInt(cutHex(t).substring(0,2),16)}function hexToG(t){return parseInt(cutHex(t).substring(2,4),16)}function hexToB(t){return parseInt(cutHex(t).substring(4,6),16)}function cutHex(t){var e=t;return"#"==t.charAt(0)&&(e=t.substring(1,7)),-1!=t.indexOf("0x")&&(e=t.substring(2,8)),e}function hexToRgb(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,i,n){return e+e+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}function supportsRGBA(){var t=!1,e=document.createElement("div");return e.style.cssText="background-color:rgba(150,255,150,.5)",~(""+e.style.backgroundColor).indexOf("rgba")&&(t=!0),t}function JQEase(t){t||(t="easeOutQuad");var e=t;if(t.indexOf(".")>-1){var i=t.split("."),n=i[0],s=i[1];"Regular"==n&&(n="Quad"),e=s+n}return e}function Screen(t){this._container,this._id=t.id,this._xmlPath=t.xmlPath,this._arElements=[],this._arEvents=[],this._screenElement=null,this._elementLoader=null,t.screenElement&&(this._screenElement=t.screenElement),xmlAttrStr($(t.screenXML),"xml")&&(this._xmlPath=$(t.screenXML).attr("xml"),-1==this._xmlPath.indexOf(".xml")&&(this._xmlPath+=".xml")),this.loadXMLCompleteHandler=function(t){this._xml=$(t),this.createElements($(t)),this.doClickEventById("screenloading",null)}}function PxLoaderImage(t,e,i){var n=this,s=null;this.img=document.createElement("img"),this.tags=e,this.priority=i;var r=function(){"complete"===n.img.readyState&&(l(),s.onLoad(n))},a=function(){l(),s.onLoad(n)},o=function(){l(),s.onError(n)},l=function(){n.unbind("load",a),n.unbind("readystatechange",r),n.unbind("error",o)};this.start=function(e){s=e,n.bind("load",a),n.bind("readystatechange",r),n.bind("error",o),n.img.src=t},this.checkStatus=function(){n.img.complete&&(l(),s.onLoad(n))},this.onTimeout=function(){l(),n.img.complete?s.onLoad(n):s.onTimeout(n)},this.getName=function(){return t},this.bind=function(t,e){n.img.addEventListener?n.img.addEventListener(t,e,!1):n.img.attachEvent&&n.img.attachEvent("on"+t,e)},this.unbind=function(t,e){n.img.removeEventListener?n.img.removeEventListener(t,e,!1):n.img.detachEvent&&n.img.detachEvent("on"+t,e)}}function Box(t){this._element=t.element,this._screen=t.element._screen,this._container=t.container,this._xml=t.xml,this._width=0,this._height=0,this._scroll=!1,this._element._width&&(this._width=this._element._width),this._element._height&&(this._height=this._element._height),xmlAttr(this._xml,"scroll")&&(this._scroll=Boolean(-1!=this._xml.attr("scroll").toLowerCase().indexOf("true")))}function Button(t){this._screen=t.element._screen,this._container=t.container,this._xml=t.xml,this._xpad=10,this._ypad=6;var e=create({type:"button",id:"btn",innerHTML:$(this._xml).text()});this._container.appendChild(e),$(e).css("width",xmlAttrStr(this._xml,"width")||"auto"),$(e).css("height",xmlAttrStr(this._xml,"height")||"auto"),xmlAttrStr(this._xml,"cursor")&&$(e).css("cursor",xmlAttrStr(this._xml,"cursor")),xmlAttrStr(this._xml,"class")&&$(e).addClass(xmlAttrStr(this._xml,"class"))}function Element(t){if(this._screen=t.screen,this._xml=$(t.xml),this._type=t.xml.tagName||"sprite",this._elementLoader,this._id=this._xml.attr("id")||t.id||this.createInstanceName(),this._load=t.load,this._collection=t.collection,this._target=null,this._container=null,this._arRollovers=[],this._arRollouts=[],this._arClicks=[],this._clicked=!1,this._text=null,this._box=null,this._audio=null,this._video=null,this._custom=null,this._webpage=null,this._initialAnimComplete=!1,this._elementScreen=null,this._timeout=null,this._display=xmlAttrStr(this._xml,"display")||"block",this._x=xmlAttrStr(this._xml,"x"),this._y=xmlAttrStr(this._xml,"y"),this._right=xmlAttrStr(this._xml,"right"),this._bottom=xmlAttrStr(this._xml,"bottom"),this._width=xmlAttrStr(this._xml,"width"),this._height=xmlAttrStr(this._xml,"height"),this._filter=xmlAttrStr(this._xml,"filter"),this._scroll=Boolean("true"==xmlAttrStr(this._xml,"scroll")),this._anim=xmlAttrStr(this._xml,"anim")||"none",this._animrotate=xmlAttrNum(this._xml,"animrotate"),this._animease=xmlAttrStr(this._xml,"ease"),this._animtime=xmlAttrNum(this._xml,"animtime"),this._animdelay=xmlAttrNum(this._xml,"animdelay"),this._animOnComplete=xmlAttrStr(this._xml,"animcomplete"),this._event=xmlAttrStr(this._xml,"event"),this._eventq=Boolean("false"!=xmlAttrStr(this._xml,"eventq")),this._requiredToClick=Boolean("false"!=xmlAttrStr(this._xml,"required")),this._drag=xmlAttrStr(this._xml,"drag"),t.x&&(this._x=t.x),t.y&&(this._y=t.y),t.width&&(this._width=t.width),t.height&&(this._height=t.height),this._screen._arElements.push(this),("box"==this._type||"div"==this._type)&&this._xml.children().length>0)for(var e=0;e<this._xml.children().length;e++){var i=this._xml.children()[e],n=this._screen.createElement({xml:i,load:!0,collection:this._collection});n&&(xmlAttrStr($(i),"target")||(n._target=this._id))}this.init()}function ElementLoader(t){this._screen=t.screen,this._elements=t.elements||[],this._onLoadComplete=t.onLoadComplete||null,this._onAnimsComplete=t.onAnimsComplete||null,this._onCompleteScope=t.onCompleteScope||this._screen,this._onCompleteParams=t.onCompleteParams||null,this._preloader=null,this._loadQueue,this._batchFinished=!1,this._loader=new PxLoader,this._loader.addProgressListener(this.progressListener.bind(this)),this._loader.addCompletionListener(this.completionListener.bind(this))}function Text(t){if(this._element=t.element,this._screen=this._element._screen,this._container=t.container,this._xml=t.xml,this._isInput=!1,this._inputListener=null,"string"==typeof this._container){var e=create({type:"div",id:this._container});this._container=e,$(this._container).css("left",t.x),$(this._container).css("top",t.y),$(this._screen._container).append(this._container)}xmlAttrStr(this._xml,"type")&&(this._isInput=Boolean("input"==this._xml.attr("type").toLowerCase())),xmlAttrStr(this._xml,"listener")&&(this._inputListener=this._xml.attr("listener")),this._isInput&&($(this._container).attr("contenteditable","true"),$(this._container).css("max-width",this._container._width));var i=this;return this._inputListener&&this._container.addEventListener("input",function(){i._screen.doClickEventById(i._inputListener,i._element)},!1),$(this._container).append(this._xml.text()),this}var supportsTouch="ontouchstart"in window||navigator.msMaxTouchPoints,bRGBASupported=supportsRGBA(),ua=navigator.userAgent.toLowerCase(),isiPad=null!=ua.match(/ipad/i),isiPhone=null!=ua.match(/iphone/i),isChrome=null!=ua.match(/chrome/i);null!==ua.match(/android 2\.[12]/)&&(HTMLMediaElement.prototype.canPlayType=function(t){return null!==t.match(/video\/(mp4|m4v)/gi)?"maybe":""}),Screen.prototype={load:function(t,e){this._elementLoader&&(this._elementLoader._arElements=null,this._elementLoader=null),this._container=t,e||this.unload(this._container),this._arElements=[],this._arEvents=[],this._xmlPath?loadXML(this._xmlPath,this.loadXMLCompleteHandler.bind(this)):alert("xml file has not been defined")},screenIsElement:function(){var t=!1;return this._screenElement&&(t=!0),t},createElements:function(t){var e=this;$(t).find("data").children().each(function(){switch(this.tagName.toLowerCase()){case"events":e.createEvents(this);break;default:e.createElement({xml:this,load:!0})}});var i=this.getElementsToLoad();this.screenIsElement()?this._elementLoader=new ElementLoader({screen:this,elements:i,onAnimsComplete:"elementScreenAnimsComplete",onCompleteParams:[],onCompleteScope:this}):this._elementLoader=new ElementLoader({screen:this,elements:i,onLoadComplete:"screenLoadComplete",onAnimsComplete:"screenAnimsComplete",onCompleteParams:[],onCompleteScope:this}),this._elementLoader.load()},getElementsToLoad:function(){for(var t=[],e=0;e<this._arElements.length;e++)this._arElements[e]._load&&t.push(this._arElements[e]);return t},createElement:function(t){return void 0==t.load&&(t.load=!0),void 0==t.collection&&(t.collection=null),new Element({screen:this,xml:t.xml,load:t.load,collection:t.collection})},createEvents:function(t){var e=this;$(t).find("event").each(function(){var t=$(this).attr("id"),i=[],n=[],s=[];$(this).find("rollover").children().each(function(){i.push($(this))}),$(this).find("rollout").children().each(function(){n.push($(this))}),$(this).find("click").children().each(function(){s.push($(this))});var r={};r._id=t,r._arRollovers=i,r._arRollouts=n,r._arClicks=s,e._arEvents.push(r)})},screenLoadComplete:function(t){},screenAnimsComplete:function(t){this.doClickEventById("screenloaded",null)},container:function(){return this._container},unload:function(t){t.innerHTML="",this._elementLoader&&this._elementLoader.stop()},hide:function(){$(this._container).hide()},show:function(){$(this._container).show()},getElementLoaderArray:function(){return this._elementLoader.getElements()},getElementById:function(t){for(var e=null,i=0;i<this._arElements.length;i++)if(this._arElements[i]._id==t){e=this._arElements[i];break}return e},getElementByType:function(t){for(var e=null,i=0;i<this._arElements.length;i++)if(this._arElements[i]._type==t){e=this._arElements[i];break}return e},getElementsByType:function(t){for(var e=[],i=0;i<this._arElements.length;i++)"input"==t?"text"==this._arElements[i]._type&&this._arElements[i]._text._isInput&&e.push(this._arElements[i]):this._arElements[i]._type==t&&e.push(this._arElements[i]);return e},getElementsByClass:function(t){for(var e=[],i=0;i<this._arElements.length;i++)$(this._arElements[i]._container).hasClass(t)&&e.push(this._arElements[i]);return e},getElementsByAttr:function(t){for(var e=[],i=0;i<this._arElements.length;i++)$(this._arElements[i]._xml).attr(t)&&e.push(this._arElements[i]);return e},getElementsByCollection:function(t){for(var e=[],i=0;i<this._arElements.length;i++)this._arElements[i]._collection&&this._arElements[i]._collection==t&&e.push(this._arElements[i]);return e},getPreviousElement:function(t){for(var e=null,i=0;i<this._arElements.length;i++)if(this._arElements[i]._id==t&&i>0){e=this._arElements[i-1];break}return e},getNextElement:function(t){for(var e=null,i=0;i<this._arElements.length;i++)if(this._arElements[i]._id==t&&i<this._arElements.length-1){e=this._arElements[i+1];break}return e},doClickEventsFromStr:function(t,e){if(t)for(var i=t.split(" ").join("").toString().split(","),n=0;n<i.length;n++)this.doClickEventById(i[n],e)},doClickEventById:function(t,e){var i=this.getScreen(t),n=this.getElementId(t),s=i.getEventById(n);if(!s)return!1;s._arClicks.length>0&&i.fireEvents(s._arClicks,e)},getEventById:function(t){for(var e=null,i=0;i<this._arEvents.length;i++)if(this._arEvents[i]._id==t){e=this._arEvents[i];break}return e},getScreen:function(t){var e=this;if(-1!=t.indexOf("."))if(-1!=t.indexOf("parent."))e=this._screenElement._screen;else if(-1!=t.indexOf("screen."))e=this._course._curScreen;else{var i=t.split("."),n=this.getElementById(i[0]);n&&n._elementScreen&&(e=n._elementScreen)}return e},getElementId:function(t){var e=t;return-1!=t.indexOf(".")&&(e=t.split(".")[1]),e},fireEvents:function(t,e){for(var i=0;i<t.length;i++){var n,s,r=$(t[i]),a=r.text().replace(/\s+/g,"").toString().split(",");switch(r[0].tagName){case"event":for(var o=0;o<a.length;o++)n=a[o],this.getScreen(n).doClickEventById(this.getElementId(n),e);break;case"css":for(var l=r.attr("name"),h=r.attr("add")||!1,c=r.attr("remove")||!1,m=0;m<a.length;m++)s="this"==(n=a[m])?e:this.getScreen(n).getElementById(this.getElementId(n)),h?$(s._container).addClass(h):c?$(s._container).removeClass(c):($(s._container).removeClass(),$(s._container).addClass(l));break;case"url":var _=r.attr("address"),u=!1;xmlAttrStr(r,"window")&&(u=Boolean("true"==r.attr("window").toLowerCase())),u?top.window.open(_).focus():document.location=_;break;case"anim":for(var d=0;d<a.length;d++){var p=(s="this"==(n=a[d])?e:this.getScreen(n).getElementById(this.getElementId(n)))._anim,f=s._animtime,g=s._animdelay;s._anim=r.attr("type"),s._animtime=r.attr("animtime"),s._animdelay=r.attr("animdelay"),s._animease=r.attr("ease"),s._animOnComplete=null,xmlAttrStr(r,"animcomplete")&&(s._animOnComplete=r.attr("animcomplete")),s.animate(),s._anim=p,s._animtime=f,s._animdelay=g}break;case"enable":for(var x=0;x<a.length;x++)(s="this"==(n=a[x])?e:this.getScreen(n).getElementById(this.getElementId(n))).enable();break;case"disable":for(var v=0;v<a.length;v++)n=a[v],(s="this"==a[v]?e:this.getScreen(n).getElementById(this.getElementId(n))).disable();break;case"function":var y=r.attr("name").toString(),b=r.text(),E=this;""==b&&(b=null),"this"==b&&(b=e);var A;if(-1!=y.indexOf(".")){var w=y.split(".");if("parent"==w[0].toLowerCase()){var S=this._screenElement;S&&(E=S.screen())}else(A=this.getElementById(w[0]))&&A._elementScreen&&(E=A._elementScreen);y=w[1]}E.searchForFunction(y,b)}}},searchForFunction:function(t,e){for(var i=0;i<this._arElements.length;i++){var n=this._arElements[i];if(n._custom&&"function"==typeof n._custom[t]){e?n._custom[t](e,this):n._custom[t](this);break}}"function"==typeof this[t]&&(e?this[t](e,this):this[t](this)),"function"==typeof window[t]&&(e?window[t](e,this):window[t](this))},id:function(){return this._id},xmlPath:function(){return this._xmlPath}},function(t){function e(t){t=t||{},this.settings=t,null==t.statusInterval&&(t.statusInterval=5e3),null==t.loggingDelay&&(t.loggingDelay=2e4),null==t.noProgressTimeout&&(t.noProgressTimeout=1/0);var e,n=[],s=[],r=Date.now(),a={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},o=function(t){return null==t?[]:Array.isArray(t)?t:[t]};this.add=function(t){t.tags=new i(t.tags),null==t.priority&&(t.priority=1/0),n.push({resource:t,status:a.QUEUED})},this.addProgressListener=function(t,e){s.push({callback:t,tags:new i(e)})},this.addCompletionListener=function(t,e){s.push({tags:new i(e),callback:function(e){e.completedCount===e.totalCount&&t(e)}})};var l=function(t){t=o(t);var e=function(e){for(var i=e.resource,n=1/0,s=0;s<i.tags.length;s++)for(var r=0;r<Math.min(t.length,n)&&!(i.tags.all[s]===t[r]&&r<n&&0===(n=r))&&0!==n;r++);return n};return function(t,i){var n=e(t),s=e(i);return n<s?-1:n>s?1:t.priority<i.priority?-1:t.priority>i.priority?1:0}};this.start=function(t){if(0==n.length)try{listener=s[1],listener.callback({completedCount:0,totalCount:0})}catch(t){}e=Date.now();var i=l(t);n.sort(i);for(var r=0,o=n.length;r<o;r++){var c=n[r];c.status=a.WAITING,c.resource.start(this)}setTimeout(h,100)};var h=function(){for(var e=!1,i=Date.now()-r,s=i>=t.noProgressTimeout,o=i>=t.loggingDelay,l=0,c=n.length;l<c;l++){var m=n[l];m.status===a.WAITING&&(m.resource.checkStatus&&m.resource.checkStatus(),m.status===a.WAITING&&(s?m.resource.onTimeout():e=!0))}o&&e&&_(),e&&setTimeout(h,t.statusInterval)};this.isBusy=function(){for(var t=0,e=n.length;t<e;t++)if(n[t].status===a.QUEUED||n[t].status===a.WAITING)return!0;return!1};var c=function(t,e){var i,o,l,h=null;for(i=0,o=n.length;i<o;i++)if(n[i].resource===t){h=n[i];break}if(null!=h&&h.status===a.WAITING)for(h.status=e,r=Date.now(),t.tags.length,i=0,o=s.length;i<o;i++)(0===(l=s[i]).tags.length||t.tags.intersects(l.tags))&&m(h,l)};this.onLoad=function(t){c(t,a.LOADED)},this.onError=function(t){c(t,a.ERROR)},this.onTimeout=function(t){c(t,a.TIMEOUT)};var m=function(t,e){var i,s,r,o=0,l=0;for(i=0,s=n.length;i<s;i++)r=n[i],!1,(0===e.tags.length||r.resource.tags.intersects(e.tags))&&(l++,r.status!==a.LOADED&&r.status!==a.ERROR&&r.status!==a.TIMEOUT||o++);e.callback({resource:t.resource,loaded:t.status===a.LOADED,error:t.status===a.ERROR,timeout:t.status===a.TIMEOUT,completedCount:o,totalCount:l})},_=this.log=function(t){if(window.console){var i=Math.round((Date.now()-e)/1e3);window.console.log("PxLoader elapsed: "+i+" sec");for(var s=0,r=n.length;s<r;s++){var o=n[s];if(t||o.status===a.WAITING){var l="PxLoader: #"+s+" "+o.resource.getName();switch(o.status){case a.QUEUED:l+=" (Not Started)";break;case a.WAITING:l+=" (Waiting)";break;case a.LOADED:l+=" (Loaded)";break;case a.ERROR:l+=" (Error)";break;case a.TIMEOUT:l+=" (Timeout)"}o.resource.tags.length>0&&(l+=" Tags: ["+o.resource.tags.all.join(",")+"]"),window.console.log(l)}}}}}function i(t){if(this.all=[],this.first=null,this.length=0,this.lookup={},t){if(Array.isArray(t))this.all=t.slice(0);else if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&this.all.push(e);else this.all.push(t);this.length=this.all.length,this.length>0&&(this.first=this.all[0]);for(var i=0;i<this.length;i++)this.lookup[this.all[i]]=!0}}i.prototype.intersects=function(t){if(0===this.length||0===t.length)return!1;if(1===this.length&&1===t.length)return this.first===t.first;if(t.length<this.length)return t.intersects(this);for(var e in this.lookup)if(t.lookup[e])return!0;return!1},"function"==typeof define&&define.amd&&define("PxLoader",[],function(){return e}),t.PxLoader=e}(this),Date.now||(Date.now=function(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),PxLoader.prototype.addImage=function(t,e,i){var n=new PxLoaderImage(t,e,i);return this.add(n),n.img},"function"==typeof define&&define.amd&&define("PxLoaderImage",[],function(){return PxLoaderImage}),Element.prototype={init:function(){switch(this._container=this.createContainer(),this._type){case"screen":var t=new Screen({course:this._screen.course(),topicId:this._screen._topicId,screenXML:this._xml,screenElement:this});this._elementScreen=t,t.load(this._container,!0);break;case"text":this._text=new Text({element:this,container:this._container,xml:this._xml});break;case"var":var e={};e.id=this._xml.attr("id"),e.value=this._xml.text(),this._screen._vars.push(e);break;case"image":break;case"box":case"div":this._box=new Box({element:this,container:this._container,xml:this._xml});break;case"button":new Button({element:this,container:this._container,xml:this._xml});break;case"audio":if(!this.course()._toggleAudioMuted){var i=this._screen.getElementById(this._xml.attr("id")),n=null;i&&(n=i._audio),i&&n?(xmlAttrStr(this._xml,"src")||this._xml.attr("src",this._xml.text()),n.swapSrc(this._xml)):this._audio=new Audio({element:this,container:this._container,xml:this._xml})}break;case"video":this._video=new Video({element:this,container:this._container,xml:this._xml});break;case"webpage":this._webpage=new Webpage({element:this,container:this._container,xml:this._xml});break;case"custom":this.createCustomElement()}},createContainer:function(){var t=create({type:"div",id:this._id});$(t).css("position","relative"),$(t).css("display",this._display),"button"==this._type&&$(t).css("display","inline-block");var e=xmlAttrStr(this._xml,"position");e&&($(t).css("position",e),"absolute"==e&&$(t).css("float","none"));var i=xmlAttrStr(this._xml,"float");i&&$(t).css("float",i);var n=xmlAttrStr(this._xml,"clear");n&&$(t).css("clear",n);var s=xmlAttrStr(this._xml,"class");s&&"button"!=this._type&&$(t).addClass(s);var r=xmlAttrStr(this._xml,"title");r&&$(t).attr("title",r);var a=xmlAttrStr(this._xml,"overflow");a&&$(t).css("overflow",a);var o=xmlAttrStr(this._xml,"overflow-x");o&&$(t).css("overflow-x",o);var l=xmlAttrStr(this._xml,"overflow-y");l&&$(t).css("overflow-y",l);var h=xmlAttrStr(this._xml,"z-index");h&&$(t).css("z-index",h);var c=xmlAttrStr(this._xml,"cursor");c&&$(t).css("cursor",c);var m=xmlAttrStr(this._xml,"padding");m&&$(t).css("padding",m);var _=xmlAttrStr(this._xml,"padding-top");_&&$(t).css("padding-top",getUnit(_));var u=xmlAttrStr(this._xml,"padding-right");u&&$(t).css("padding-right",getUnit(u));var d=xmlAttrStr(this._xml,"padding-bottom");d&&$(t).css("padding-bottom",getUnit(d));var p=xmlAttrStr(this._xml,"padding-left");p&&$(t).css("padding-left",getUnit(p));var f=xmlAttrStr(this._xml,"margin");f&&$(t).css("margin",f);var g=xmlAttrStr(this._xml,"margin-top");g&&$(t).css("margin-top",getUnit(g));var x=xmlAttrStr(this._xml,"margin-right");x&&$(t).css("margin-right",getUnit(x));var v=xmlAttrStr(this._xml,"margin-bottom");v&&$(t).css("margin-bottom",getUnit(v));var y=xmlAttrStr(this._xml,"margin-left");y&&$(t).css("margin-left",getUnit(y));var b=xmlAttrStr(this._xml,"min-width");b&&$(t).css("min-width",getUnit(b));var E=xmlAttrStr(this._xml,"max-width");E&&$(t).css("max-width",getUnit(E));var A=xmlAttrStr(this._xml,"min-height");A&&$(t).css("min-height",getUnit(A));var w=xmlAttrStr(this._xml,"max-height");w&&$(t).css("max-height",getUnit(w));var S=xmlAttrStr(this._xml,"vertical-align");S&&$(t).css("vertical-align",S),xmlAttrStr(this._xml,"border")&&$(t).css("border","border");var C=xmlAttrStr(this._xml,"text-align");C&&$(t).css("text-align",C);var k=xmlAttrStr(this._xml,"flex-wrap");k&&$(t).css("flex-wrap",k);var L=xmlAttrStr(this._xml,"flex-flow");L&&$(t).css("flex-flow",L);var I=xmlAttrStr(this._xml,"flex");I&&$(t).css("flex",I);var O=xmlAttrStr(this._xml,"flex-grow");O&&$(t).css("flex-grow",O);var T=xmlAttrStr(this._xml,"align-items");T&&$(t).css("align-items",T);var B=xmlAttrStr(this._xml,"align-content");B&&$(t).css("align-content",B);var P=xmlAttrStr(this._xml,"align-self");P&&$(t).css("align-self",P);var R=xmlAttrStr(this._xml,"justify-content");R&&$(t).css("justify-content",R);var N=xmlAttrStr(this._xml,"order");N&&$(t).css("order",N);var M=xmlAttrStr(this._xml,"style");M&&$(t).attr("style",$(t).attr("style")+M);var U=xmlAttrStr(this._xml,"tabindex");U&&$(t).attr("tabindex",U);var D=xmlAttrStr(this._xml,"role");D&&$(t).attr("role",D);var Q=xmlAttrStr(this._xml,"aria-label");if(Q&&$(t).attr("aria-label",Q),this._scroll){var H=this._xml.attr("scroll").toLowerCase(),J=-1!=H.indexOf("x"),F=-1!=H.indexOf("y");-1!=H.indexOf("touch")?supportsTouch&&(J?$(t).css("overflow-x","auto"):F?$(t).css("overflow-y","auto"):($(t).css("overflow-y","auto"),$(t).css("overflow-x","auto"))):J?($(t).css("overflow-x","auto"),$(t).css("overflow-y","hidden")):F?($(t).css("overflow-y","auto"),$(t).css("overflow-x","hidden")):($(t).css("overflow-y","auto"),$(t).css("overflow-x","auto")),$(t).css("-webkit-overflow-scrolling","touch")}return this._x&&$(t).css("left",getUnit(this._x)),this._y&&$(t).css("top",getUnit(this._y)),this._right&&$(t).css("right",getUnit(this._right)),this._bottom&&$(t).css("bottom",getUnit(this._bottom)),this._width&&$(t).css("width",this._width),this._height&&$(t).css("height",this._height),$(t).css("opacity",0),$(t).css("visibility","hidden"),t},createCustomElement:function(){switch(this._xml.attr("type").toLowerCase()){case"mcq":this._custom=new MCQ({element:this});break;case"quiz":this._custom=new Quiz({element:this});break;default:alert("unrecognised custom screen element "+this._xml.attr("type"))}},append:function(){$(this.getTarget()).append(this._container),this._initialAnimComplete=!1,(this.hasNoAnim()||this.notInEventQ())&&(this._initialAnimComplete=!0)},getTarget:function(){var t,e=this._screen.container(),i=xmlAttrStr(this._xml,"target");if(i){if(t=this._screen.getElementById(i))return t.container();if(get(xmlAttrStr(this._xml,"target")))return get(xmlAttrStr(this._xml,"target"))}return this._target?(t=this._screen.getElementById(this._target))?t.container():get(this._target)?get(this._target):this._target:e},animate:function(){for(var t,e=this._anim.split("|"),i=0;i<e.length;i++){var n;-1!=(t=e[i]).indexOf("top_")&&(-1!=(n=t.split("_")[1]).toString().indexOf("+=")&&(n=this._y+Number(n.toString().replace("+=",""))),-1!=n.toString().indexOf("-=")&&(n=this._y-Number(n.toString().replace("-=",""))),-1!=n.toString().indexOf("orig")&&(n=this._y),t="moveTop");var s;-1!=t.indexOf("left_")&&(-1!=(s=t.split("_")[1]).toString().indexOf("+=")&&(s=this._x+Number(s.replace("+=",""))),-1!=s.toString().indexOf("-=")&&(s=this._x-Number(s.replace("-=",""))),-1!=s.toString().indexOf("orig")&&(s=this._x),t="moveLeft");var r;-1!=t.indexOf("scale_")?((r=parseFloat(t.split("_")[1]))>1&&(r/=100),t=-1!=t.indexOf("lscale_")?"lscale":"scale"):r=1;this._animease;var a=this;switch(t){case"remove":o={opacity:0};$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:function(){$(a._container).remove()}});break;case"enable":case"enabled":"button"==this._type?this.enableBtn():this.enable();break;case"disable":case"disabled":if("button"==this._type){o={opacity:.2};$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.disableBtn.bind(this)})}else this.disable();break;case"hidden":case"hide":o={opacity:0};$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:function(){a.registerAnimComplete.bind(a),$(a._container).css("visiblity","hidden")}});break;case"alpha":case"show":o={opacity:1,queue:!1};$(this._container).css("visibility","visible"),$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"top":var o={top:this._y,opacity:1},l=-1*parseInt($(this._screen._container).css("height"))-50;$(this._container).css("top",l),$(this._container).css("visibility","visible"),$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"bottom":var o={top:this._y,opacity:1},l=parseInt($(this._screen._container).css("height"))+50;$(this._container).css("top",l),$(this._container).css("visibility","visible"),$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"left":var o={left:this._x,opacity:1},l=-1*parseInt($(this._screen._container).css("width"))-50;$(this._container).css("left",l),$(this._container).css("visibility","visible"),$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"right":var o={left:this._x,opacity:1},l=parseInt($(this._screen._container).css("width"))+50;$(this._container).css("left",l),$(this._container).css("visibility","visible"),$(this._container).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"moveTop":case"movetop":o={top:n,opacity:1};$(this._container).css("visibility","visible"),$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"moveLeft":case"moveleft":o={left:s,opacity:1};$(this._container).css("visibility","visible"),$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"drop":o={scale:1,opacity:1};$(this._container).css("scale",3),$(this._container).css("opacity",0),$(this._container).css("visibility","visible"),$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"scale":o={scale:r,opacity:1};$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;case"lscale":break;case"scaleup":o={scale:1,opacity:1};$(this._container).css("scale",0),$(this._container).css("opacity",0),$(this._container).css("visibility","visible"),$(this._container).stop(!0,!1).delay(1e3*this._animdelay).animate(o,{duration:1e3*this._animtime,easing:JQEase(this._animease),complete:this.registerAnimComplete.bind(this)});break;default:$(this._container).show(),$(this._container).css("visibility","visible"),$(this._container).css("opacity",1),this.registerAnimComplete()}}},registerAnimComplete:function(){if(this._initialAnimComplete=!0,this._animOnComplete){var t=this._animOnComplete;this._animOnComplete=null;var e=this;this._timeout=window.setTimeout(function(){e._screen.doClickEventById(t,e)},e._animdelay)}this._elementLoader&&this._elementLoader.checkBatchAnimsComplete()},registerEvents:function(){if("disabled"!==this._anim&&"disable"!==this._anim){this._arRollovers=[],this._arRollouts=[],this._arClicks=[];var t,e=!1,i=!1,n=!1,s=this._event.split(",");$(this._container).off();for(var r=0;r<s.length;r++)if(t=this._screen.getEventById(s[r])){if(t._arRollovers.length>0){e=!0;for(a=0;a<t._arRollovers.length;a++)this._arRollovers.push(t._arRollovers[a])}if(t._arRollouts.length>0){i=!0;for(a=0;a<t._arRollouts.length;a++)this._arRollouts.push(t._arRollouts[a]),this._screen.fireEvents(t._arRollouts[a],this)}if(t._arClicks.length>0){n=!0;for(var a=0;a<t._arClicks.length;a++)this._arClicks.push(t._arClicks[a])}}e&&(supportsTouch||$(this._container).on("mouseenter",this.mouseOverHandler.bind(this)),$(this._container).on("focus",this.mouseOverHandler.bind(this)),xmlAttrStr(this._xml,"cursor")||$(this._container).css("cursor","pointer")),i&&(supportsTouch||$(this._container).on("mouseleave",this.mouseOutHandler.bind(this)),$(this._container).on("blur",this.blurHandler.bind(this))),n&&($(this._container).attr("tabindex","0"),$(this._container).attr("role","button"),$(this._container).on("click",this.clickHandler.bind(this)),$(this._container).on("keydown",this.keyDownHandler.bind(this)),xmlAttrStr(this._xml,"cursor")||($(this._container).css("cursor","pointer"),$(this._container).children().css("cursor","pointer")))}},mouseOverHandler:function(t){this._screen.fireEvents(this._arRollovers,this)},mouseOutHandler:function(t){this._screen.fireEvents(this._arRollouts,this)},blurHandler:function(t){this._selected||this._screen.fireEvents(this._arRollouts,this)},clickHandler:function(t){t.stopPropagation(),t.preventDefault(),this._clicked=!0,this._screen.fireEvents(this._arClicks,this)},keyDownHandler:function(t){13!=t.keyCode&&32!=t.keyCode||this._screen.fireEvents(this._arClicks,this)},disable:function(){$(this._container).off(),$(this._container).css("cursor","default"),$(this._container).children().css("cursor","default"),$(this._container).attr("tabindex","-1")},enable:function(){this._event&&(-1!=this._anim.indexOf("disable")&&(this._anim="showdisabled"),this.registerEvents(),"showdisabled"===this._anim&&(this._anim="disabled"))},disableBtn:function(){this.disable(),$(this._container).find("button").css("cursor","default"),$(this._container).css("visibility","visible"),$(this._container).css("zoom","1"),$(this._container).css("opacity",.2)},enableBtn:function(){this.enable(),$(this._container).find("button").css("cursor","pointer"),$(this._container).css("visibility","visible"),$(this._container).css("display","inline-block"),$(this._container).css("opacity",1)},rollover:function(){for(var t=0;t<this._arRollovers.length;t++)this._screen.fireEvents(this._arRollovers[t],this)},rollout:function(){for(var t=0;t<this._arRollouts.length;t++)this._screen.fireEvents(this._arRollouts[t],this)},hide:function(){$(this._container).css("opacity",0),$(this._container).css("visibility","hidden")},show:function(){$(this._container).css("opacity",1),$(this._container).show()},reset:function(){"hidden"!==this._anim&&"hide"!==this._anim||this.hide(),"show"!==this._anim&&"top"!==this._anim&&"left"!==this._anim&&"right"!==this._anim&&"bottom"!==this._anim&&"scaleup"!==this._anim&&"drop"!==this._anim||this.hide(),this._event&&(this._arRollouts.length>0&&this.rollout(),-1==this._anim.indexOf("disable")&&this.enable()),"button"===this._type&&-1!=this._anim.indexOf("disable")&&this.disableBtn(),$(this._container).css("left",this._x),$(this._container).css("top",this._y),this._custom&&"function"==typeof this._custom.reset&&this._custom.reset()},elementLoader:function(){return this._elementLoader},createInstanceName:function(){return"element"+(this._screen._arElements.length+1)},hasNoAnim:function(){return null===this._anim||"none"===this._anim||"hidden"===this._anim||"hide"===this._anim||"disabled"===this._anim||"disable"===this._anim||""===this._anim},notInEventQ:function(){return!1===this._eventq},container:function(){return this._container},type:function(){return this._type.toLowerCase()},screen:function(){return this._screen}},ElementLoader.prototype={load:function(){this._batchFinished=!1,this.attachPreloader();for(t=0;t<this._elements.length;t++)this._elements[t].append();for(var t=0;t<this._elements.length;t++)if(this._elements[t]._elementLoader=this,"image"==this._elements[t]._type){var e=xmlAttrStr(this._elements[t]._xml,"src"),i=null,n=xmlAttrStr(this._elements[t]._xml,"bg_src");n&&(i=e=n);var s=new PxLoaderImage(e);s.element=this._elements[t],s.bg_src=i,this._loader.add(s)}this._loader.start()},progressListener:function(t){var e=t.resource.element;if(t.resource.bg_src)$(e._container).css("background-image","url("+t.resource.bg_src+")");else{var i=document.createElement("img");i.src=t.resource.getName(),e._height&&$(i).attr("height",e._height),e._width&&$(i).attr("width",e._width);var n=xmlAttrStr(e._xml,"min-height");n&&$(i).css("min-height",getUnit(n));var s=xmlAttrStr(e._xml,"min-width");s&&$(i).css("min-width",getUnit(s));var r=xmlAttrStr(e._xml,"max-height");r&&$(i).css("max-height",getUnit(r));var a=xmlAttrStr(e._xml,"max-width");a&&$(i).css("max-width",getUnit(a)),$(e._container).html(i)}},completionListener:function(t){this.hidePreloader(),this.initElements(),this._onLoadComplete&&(this._onCompleteParams?this._onCompleteScope[this._onLoadComplete](this._onCompleteParams):this._onCompleteScope[this._onLoadComplete]())},initElements:function(){for(var t=0;t<this._elements.length;t++)"custom"==this._elements[t]._type&&this._elements[t]._custom.init&&this._elements[t]._custom.init(),this._elements[t].animate()},checkAllAnimsComplete:function(){var t=!0;try{for(var e=0;e<this._elements.length;e++)if(!this._elements[e].hasNoAnim()&&!this._elements[e]._initialAnimComplete){t=!1;break}return t}catch(t){return!1}},checkBatchAnimsComplete:function(){if(this.checkAllAnimsComplete()&&!this._batchFinished){this._batchFinished=!0;for(var t=0;t<this._elements.length;t++)this._elements[t]._event&&this._elements[t].registerEvents();this._onAnimsComplete&&(this._onCompleteParams?this._onCompleteScope[this._onAnimsComplete](this._onCompleteParams):this._onCompleteScope[this._onAnimsComplete]())}},showPreloader:function(){$(this._preloader).show()},attachPreloader:function(){if(!get("preloader")){this._preloader=create({type:"div",id:"preloader",className:"preloader"}),$(this._preloader).css("z-index",9999),this._screen.container().appendChild(this._preloader),$(this._preloader).hide();var t=($(this._screen.container()).innerWidth()-34)/2,e=($(this._screen.container()).innerHeight()-34)/2;$(this._preloader).css("top",e),$(this._preloader).css("left",t),this.showPreloader()}},removePreloader:function(){try{this._screen.container().removeChild(this._preloader),this._preloader=null}catch(t){}},hidePreloader:function(){this._preloader&&$(this._preloader).animate({opacity:0},{duration:1e3,complete:this.removePreloader.bind(this)})},getElements:function(){return this._elements},addElement:function(t){this.getElements().push(t)},getElementById:function(t){for(var e=null,i=0;i<this._elements.length;i++)if(this._elements[i]._id==t){e=this._elements[i];break}return e},getElementByType:function(t){for(var e=null,i=0;i<this._elements[i].length;i++)if(this._elements[i]._type==t){e=this._elements[i];break}return e},getPreviousElement:function(t){for(var e=null,i=0;i<this._elements.length;i++)if(this._elements[i]._id==t&&i>0){e=this._elements[i-1];break}return e},getNextElement:function(t){for(var e=null,i=0;i<this._elements.length;i++)if(this._elements[i]._id==t&&i<this._elements.length-1){e=this._elements[i+1];break}return e},stop:function(){this._loader.addCompletionListener(function(t){return!1}),this._loader.addProgressListener(function(t){return!1}),this._onLoadComplete=null,this._onAnimsComplete=null}},Text.prototype={reset:function(){$(this._container).html(this._xml.text())},replace:function(t,e){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var i=new RegExp(t,"g"),n=this._container.innerHTML.replace(i,e);$(this._container).html(n)}};